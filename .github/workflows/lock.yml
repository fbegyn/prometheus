name: 'Lock Threads'

on:
  schedule:
    - cron: '13 23 * * *'
  workflow_dispatch:

permissions:
  issues: write

concurrency:
  group: lock

jobs:
  fork_check:
    name: check for fork
    runs-on: ubuntu-latest
    outputs:
      check_fork: ${{ steps.check_fork.outputs.check_fork }}
    steps:
      - uses: actions/checkout@v3
      - id: check_fork
        run: |
          FORK=$(gh repo view $(git config --get remote.origin.url) --json isFork --jq .isFork)
          echo "check_fork=$FORK" >> $GITHUB_OUTPUT
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  action:
    runs-on: ubuntu-latest
    needs: [fork_check]
    if: ${{ !needs.fork_check.outputs.check_fork }}
    steps:
      - uses: dessant/lock-threads@v4
        with:
          process-only: 'issues'
          issue-inactive-days: '180'
          github-token: ${{ secrets.PROMBOT_LOCKTHREADS_TOKEN }}
